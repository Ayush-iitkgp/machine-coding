---
name: alembic-migration
description: Triggers an Alembic autogenerated migration and applies it to the database.
---

# Alembic Migration Workflow

Use this skill whenever a SQLAlchemy model in the `backend/models/` directory is added, modified, or deleted.

## Execution Steps

1. **Environment Setup:** - Navigate to the `backend/` directory.
   - Ensure the virtual environment is active or use `python -m alembic`.

2. **Generate Migration:**
   - Run: `alembic revision --autogenerate -m "<descriptive_message>"`
   - Use imperative mood for the message (e.g., "add_user_table", "update_claim_status_type").

3. **Validation:**
   - Locate the newly created file in `backend/alembic/versions/`.
   - Read the `upgrade()` and `downgrade()` functions.
   - **Crucial:** Verify that any `NOT NULL` constraints on existing tables have a default value or a nullable setting.

4. **Apply Migration:**
   - Run: `alembic upgrade head`.

5. **Verification:**
   - Confirm the operation was successful by checking for any database connection errors.

## Guardrails
- If a migration contains a `DROP TABLE` or `DROP COLUMN` command, **stop and ask the user for confirmation** before running `upgrade head`.
- Ensure `PYTHONPATH` includes the `backend` directory so Alembic can import the models.